(function(){if(this.DynamicTextarea)return;var DynamicTextarea=this.DynamicTextarea=new Class({Implements:[Options,Events],options:{value:'',minRows:1,delay:true,lineHeight:null,offset:0,padding:0},textarea:null,initialize:function(textarea,options){this.textarea=document.id(textarea);if(!this.textarea)return;this.setOptions(options);this.parentEl=new Element('div',{styles:{padding:0,margin:0,border:0,height:'auto',width:'auto'}}).inject(this.textarea,'after').adopt(this.textarea);['focus','delayCheck','blur','scrollFix','checkSize','clean','disable','enable','getLineHeight'].each(function(method){this[method]=this[method].bind(this);},this);this.options.offset=Math.round(parseFloat(this.textarea.getStyle('border-bottom-width')))+
Math.round(parseFloat(this.textarea.getStyle('border-top-width')));if(isNaN(this.options.offset)){this.options.offset=0;}
this.options.padding=0;this.textarea.set({'rows':1,'styles':{'resize':'none','-moz-resize':'none','-webkit-resize':'none','position':'relative','display':'block','overflow':'hidden','height':'auto'}});this.getLineHeight();this.fireEvent('customLineHeight');this.checkSize(true);this.textarea.addEvent('focus',this.focus);this.fireEvent('init',[textarea,options]);},getLineHeight:function(){var backupValue=this.textarea.value;this.textarea.value='M';this.options.lineHeight=this.textarea.getScrollSize().y-this.options.padding;this.textarea.value=backupValue;this.textarea.setStyle('height',this.options.lineHeight*this.options.minRows);},scrollFix:function(){this.textarea.scrollTo(0,0);},focus:function(){this.textarea.addEvents({'keydown':this.delayCheck,'keypress':this.delayCheck,'blur':this.blur,'scroll':this.scrollFix});return this.fireEvent('focus');},blur:function(){this.textarea.removeEvents({'keydown':this.delayCheck,'keypress':this.delayCheck,'blur':this.blur,'scroll':this.scrollFix});return this.fireEvent('blur');},delayCheck:function(){if(this.options.delay===true)
this.options.delay=this.checkSize.delay(1);},checkSize:function(forced){var oldValue=this.options.value,modifiedParent=false;this.options.value=this.textarea.value;this.options.delay=false;if(this.options.value===oldValue&&forced!==true)
return this.options.delay=true;if(!oldValue||this.options.value.length<oldValue.length||forced){modifiedParent=true;this.parentEl.setStyle('height',this.parentEl.getSize().y);this.textarea.setStyle('height',this.options.minRows*this.options.lineHeight);}
var tempHeight=this.textarea.getScrollSize().y,offsetHeight=this.textarea.offsetHeight,cssHeight=tempHeight-this.options.padding,scrollHeight=tempHeight+this.options.offset;if(scrollHeight!==offsetHeight&&cssHeight>this.options.minRows*this.options.lineHeight){this.textarea.setStyle('height',cssHeight);this.fireEvent('resize');}
if(modifiedParent)this.parentEl.setStyle('height','auto');this.options.delay=true;if(forced!==true)
return this.fireEvent('keyPress');},clean:function(){this.textarea.removeEvents({'focus':this.focus,'keydown':this.delayCheck,'keypress':this.delayCheck,'blur':this.blur,'scroll':this.scrollFix});return this.fireEvent('clean');},disable:function(){this.textarea.blur();this.clean();this.textarea.set(this.options.disabled,true);return this.fireEvent('disable');},enable:function(){this.textarea.addEvents({'focus':this.focus,'scroll':this.scrollFix});this.textarea.set(this.options.disabled,false);return this.fireEvent('enable');}});})();var PlaceholderSupport=new Class({initialize:function(els){if(('placeholder'in document.createElement('input')))
return;var self=this;this.elements=(typeOf(els)==='string')?$$(els):els;if(typeOf(this.elements)==='null'||typeOf(this.elements[0])==='null'){this.elements=$$('input[placeholder],textarea[placeholder]');}
this.elements.each(function(input){var textColor=input.getStyle('color');var lighterTextColor=self.LightenDarkenColor(textColor,80);if(input.getProperty('value')===''){input.setProperty('value',input.getProperty('placeholder'));input.setStyle('color',lighterTextColor);}
input.addEvents({focus:function(){if(input.getProperty('value')===input.getProperty('placeholder')){input.setProperty('value','');input.setStyle('color',textColor);}},blur:function(){if(input.getProperty('value')===''){input.setProperty('value',input.getProperty('placeholder'));input.setStyle('color',lighterTextColor);}}});});},LightenDarkenColor:function LightenDarkenColor(col,amt){var usePound=false;if(col[0]=="#"){col=col.slice(1);usePound=true;}
var num=parseInt(col,16);var r=(num>>16)+amt;if(r>255)r=255;else if(r<0)r=0;var b=((num>>8)&0x00FF)+amt;if(b>255)b=255;else if(b<0)b=0;var g=(num&0x0000FF)+amt;if(g>255)g=255;else if(g<0)g=0;var rStr=(r.toString(16).length<2)?'0'+r.toString(16):r.toString(16);var gStr=(g.toString(16).length<2)?'0'+g.toString(16):g.toString(16);var bStr=(b.toString(16).length<2)?'0'+b.toString(16):b.toString(16);return(usePound?"#":"")+rStr+gStr+bStr;}});(function(){var transforms={'f':function(a,b,c){return(a&b)|((~a)&c);},'g':function(a,b,c){return(a&c)|(b&(~c));},'h':function(a,b,c){return(a^b^c);},'i':function(a,b,c){return(b^(a|(~c)));},'rotateLeft':function(a,b){return(a<<b)|(a>>>(32-b));},'addUnsigned':function(a,b){var a8=(a&0x80000000),b8=(b&0x80000000),a4=(a&0x40000000),b4=(b&0x40000000),result=(a&0x3FFFFFFF)+(b&0x3FFFFFFF);if(a4&b4){return(result^0x80000000^a8^b8);}
if(a4|b4){if(result&0x40000000){return(result^0xC0000000^a8^b8);}else{return(result^0x40000000^a8^b8);}}else{return(result^a8^b8);}},'compound':function(a,b,c,d,e,f,g,h){var trans=transforms,add=trans.addUnsigned,temp=add(b,add(add(trans[a](c,d,e),g),f));return add(trans.rotateLeft(temp,h),c);}};function convertToArray(string){var messageLength=string.length,numberOfWords=(((messageLength+8)-((messageLength+8)%64))/ 64+1)*16,wordArray=new Array(),wordCount=bytePosition=byteCount=0;while(byteCount<messageLength){wordCount=(byteCount-(byteCount%4))/ 4;bytePosition=(byteCount%4)*8;wordArray[wordCount]=(wordArray[wordCount]|(string.charCodeAt(byteCount)<<bytePosition));byteCount++;}
wordCount=(byteCount-(byteCount%4))/ 4;bytePosition=(byteCount%4)*8;wordArray[wordCount]=wordArray[wordCount]|(0x80<<bytePosition);wordArray[numberOfWords-2]=messageLength<<3;wordArray[numberOfWords-1]=messageLength>>>29;return wordArray;}
function convertToHex(string){var result=temp=nibble=i='';for(i=0;i<=3;i++){nibble=(string>>>(i*8))&255;temp="0"+nibble.toString(16);result=result+temp.substr(temp.length-2,2);}
return result;}
function md5(string){var t1,t2,t3,t4,x=convertToArray(string.toUTF8()),a=0x67452301,b=0xEFCDAB89,c=0x98BADCFE,d=0x10325476,s1=7,s2=12,s3=17,s4=22,s5=5,s6=9,s7=14,s8=20,s9=4,s10=11,s11=16,s12=23,s13=6,s14=10,s15=15,s16=21;for(var k=0;k<x.length;k+=16){t1=a;t2=b;t3=c;t4=d;a=transforms.compound('f',a,b,c,d,0xD76AA478,x[k+0],s1);d=transforms.compound('f',d,a,b,c,0xE8C7B756,x[k+1],s2);c=transforms.compound('f',c,d,a,b,0x242070DB,x[k+2],s3);b=transforms.compound('f',b,c,d,a,0xC1BDCEEE,x[k+3],s4);a=transforms.compound('f',a,b,c,d,0xF57C0FAF,x[k+4],s1);d=transforms.compound('f',d,a,b,c,0x4787C62A,x[k+5],s2);c=transforms.compound('f',c,d,a,b,0xA8304613,x[k+6],s3);b=transforms.compound('f',b,c,d,a,0xFD469501,x[k+7],s4);a=transforms.compound('f',a,b,c,d,0x698098D8,x[k+8],s1);d=transforms.compound('f',d,a,b,c,0x8B44F7AF,x[k+9],s2);c=transforms.compound('f',c,d,a,b,0xFFFF5BB1,x[k+10],s3);b=transforms.compound('f',b,c,d,a,0x895CD7BE,x[k+11],s4);a=transforms.compound('f',a,b,c,d,0x6B901122,x[k+12],s1);d=transforms.compound('f',d,a,b,c,0xFD987193,x[k+13],s2);c=transforms.compound('f',c,d,a,b,0xA679438E,x[k+14],s3);b=transforms.compound('f',b,c,d,a,0x49B40821,x[k+15],s4);a=transforms.compound('g',a,b,c,d,0xF61E2562,x[k+1],s5);d=transforms.compound('g',d,a,b,c,0xC040B340,x[k+6],s6);c=transforms.compound('g',c,d,a,b,0x265E5A51,x[k+11],s7);b=transforms.compound('g',b,c,d,a,0xE9B6C7AA,x[k+0],s8);a=transforms.compound('g',a,b,c,d,0xD62F105D,x[k+5],s5);d=transforms.compound('g',d,a,b,c,0x2441453,x[k+10],s6);c=transforms.compound('g',c,d,a,b,0xD8A1E681,x[k+15],s7);b=transforms.compound('g',b,c,d,a,0xE7D3FBC8,x[k+4],s8);a=transforms.compound('g',a,b,c,d,0x21E1CDE6,x[k+9],s5);d=transforms.compound('g',d,a,b,c,0xC33707D6,x[k+14],s6);c=transforms.compound('g',c,d,a,b,0xF4D50D87,x[k+3],s7);b=transforms.compound('g',b,c,d,a,0x455A14ED,x[k+8],s8);a=transforms.compound('g',a,b,c,d,0xA9E3E905,x[k+13],s5);d=transforms.compound('g',d,a,b,c,0xFCEFA3F8,x[k+2],s6);c=transforms.compound('g',c,d,a,b,0x676F02D9,x[k+7],s7);b=transforms.compound('g',b,c,d,a,0x8D2A4C8A,x[k+12],s8);a=transforms.compound('h',a,b,c,d,0xFFFA3942,x[k+5],s9);d=transforms.compound('h',d,a,b,c,0x8771F681,x[k+8],s10);c=transforms.compound('h',c,d,a,b,0x6D9D6122,x[k+11],s11);b=transforms.compound('h',b,c,d,a,0xFDE5380C,x[k+14],s12);a=transforms.compound('h',a,b,c,d,0xA4BEEA44,x[k+1],s9);d=transforms.compound('h',d,a,b,c,0x4BDECFA9,x[k+4],s10);c=transforms.compound('h',c,d,a,b,0xF6BB4B60,x[k+7],s11);b=transforms.compound('h',b,c,d,a,0xBEBFBC70,x[k+10],s12);a=transforms.compound('h',a,b,c,d,0x289B7EC6,x[k+13],s9);d=transforms.compound('h',d,a,b,c,0xEAA127FA,x[k+0],s10);c=transforms.compound('h',c,d,a,b,0xD4EF3085,x[k+3],s11);b=transforms.compound('h',b,c,d,a,0x4881D05,x[k+6],s12);a=transforms.compound('h',a,b,c,d,0xD9D4D039,x[k+9],s9);d=transforms.compound('h',d,a,b,c,0xE6DB99E5,x[k+12],s10);c=transforms.compound('h',c,d,a,b,0x1FA27CF8,x[k+15],s11);b=transforms.compound('h',b,c,d,a,0xC4AC5665,x[k+2],s12);a=transforms.compound('i',a,b,c,d,0xF4292244,x[k+0],s13);d=transforms.compound('i',d,a,b,c,0x432AFF97,x[k+7],s14);c=transforms.compound('i',c,d,a,b,0xAB9423A7,x[k+14],s15);b=transforms.compound('i',b,c,d,a,0xFC93A039,x[k+5],s16);a=transforms.compound('i',a,b,c,d,0x655B59C3,x[k+12],s13);d=transforms.compound('i',d,a,b,c,0x8F0CCC92,x[k+3],s14);c=transforms.compound('i',c,d,a,b,0xFFEFF47D,x[k+10],s15);b=transforms.compound('i',b,c,d,a,0x85845DD1,x[k+1],s16);a=transforms.compound('i',a,b,c,d,0x6FA87E4F,x[k+8],s13);d=transforms.compound('i',d,a,b,c,0xFE2CE6E0,x[k+15],s14);c=transforms.compound('i',c,d,a,b,0xA3014314,x[k+6],s15);b=transforms.compound('i',b,c,d,a,0x4E0811A1,x[k+13],s16);a=transforms.compound('i',a,b,c,d,0xF7537E82,x[k+4],s13);d=transforms.compound('i',d,a,b,c,0xBD3AF235,x[k+11],s14);c=transforms.compound('i',c,d,a,b,0x2AD7D2BB,x[k+2],s15);b=transforms.compound('i',b,c,d,a,0xEB86D391,x[k+9],s16);a=transforms.addUnsigned(a,t1);b=transforms.addUnsigned(b,t2);c=transforms.addUnsigned(c,t3);d=transforms.addUnsigned(d,t4);}
return(convertToHex(a)+convertToHex(b)+convertToHex(c)+convertToHex(d)).toLowerCase();}
String.implement({'toMD5':function(){return md5(this);}});})();(function(){function toUTF8(string){var a=0,result='',code=String.fromCharCode,string=string.replace(/\r\n/g,"\n");for(a=0;b=string.charCodeAt(a);a++){if(b<128){result+=code(b);}else if((b>127)&&(b<2048)){result+=code((b>>6)|192);result+=code((b&63)|128);}else{result+=code((b>>12)|224);result+=code(((b>>6)&63)|128);result+=code((b&63)|128);}}
return result;}
function fromUTF8(string){var a=0,result='',c1=c2=c3=0;while(a<string.length){c1=string.charCodeAt(a);if(c1<128){result+=String.fromCharCode(c1);a++;}else if((c1>191)&&(c1<224)){c2=string.charCodeAt(a+1);result+=String.fromCharCode(((c1&31)<<6)|(c2&63));a+=2;}else{c2=string.charCodeAt(a+1);c3=string.charCodeAt(a+2);result+=String.fromCharCode(((c1&15)<<12)|((c2&63)<<6)|(c3&63));a+=3;}}
return result;}
String.implement({'toUTF8':function(){return toUTF8(this);},'fromUTF8':function(){return fromUTF8(this);}});})();
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(root,factory){if(typeof exports==="object"&&exports){module.exports=factory;}else if(typeof define==="function"&&define.amd){define(factory);}else{root.Mustache=factory;}}(this,(function(){var exports={};exports.name="mustache.js";exports.version="0.7.2";exports.tags=["{{","}}"];exports.Scanner=Scanner;exports.Context=Context;exports.Writer=Writer;var whiteRe=/\s*/;var spaceRe=/\s+/;var nonSpaceRe=/\S/;var eqRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function testRe(re,string){return RegExp.prototype.test.call(re,string);}
function isWhitespace(string){return!testRe(nonSpaceRe,string);}
var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");}
var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;',"/":'&#x2F;'};function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s];});}
exports.escape=escapeHtml;function Scanner(string){this.string=string;this.tail=string;this.pos=0;}
Scanner.prototype.eos=function(){return this.tail==="";};Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&match.index===0){this.tail=this.tail.substring(match[0].length);this.pos+=match[0].length;return match[0];}
return"";};Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case-1:match=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos);this.tail=this.tail.substring(pos);this.pos+=pos;}
return match;};function Context(view,parent){this.view=view;this.parent=parent;this._cache={};}
Context.make=function(view){return(view instanceof Context)?view:new Context(view);};Context.prototype.push=function(view){return new Context(view,this);};Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if(name=='.'){value=this.view;}else{var context=this;while(context){if(name.indexOf('.')>0){value=context.view;var names=name.split('.'),i=0;while(value&&i<names.length){value=value[names[i++]];}}else{value=context.view[name];}
if(value!=null)break;context=context.parent;}}
this._cache[name]=value;}
if(typeof value==='function'){var view=this.view;if(name.indexOf('.')>0){var objects=name.split('.');objects.pop();if(objects.length){i=0;while(view&&i<objects.length){view=view[objects[i++]];}}}
value=value.call(view);}
return value;};function Writer(){this.clearCache();}
Writer.prototype.clearCache=function(){this._cache={};this._partialCache={};};Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=exports.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template);}
return fn;};Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);this._partialCache[name]=fn;return fn;};Writer.prototype.getPartial=function(name){if(!(name in this._partialCache)&&this._loadPartial){this.compilePartial(name,this._loadPartial(name));}
return this._partialCache[name];};Writer.prototype.compileTokens=function(tokens,template){var self=this;return function(view,partials){if(partials){if(typeof partials==='function'){self._loadPartial=partials;}else{for(var name in partials){self.compilePartial(name,partials[name]);}}}
return renderTokens(tokens,self,Context.make(view),template);};};Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials);};function renderTokens(tokens,writer,context,template){var buffer='';var token,tokenValue,value;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];tokenValue=token[1];switch(token[0]){case'#':value=context.lookup(tokenValue);if(typeof value==='object'){if(isArray(value)){for(var j=0,jlen=value.length;j<jlen;++j){buffer+=renderTokens(token[4],writer,context.push(value[j]),template);}}else if(value){buffer+=renderTokens(token[4],writer,context.push(value),template);}}else if(typeof value==='function'){var text=template==null?null:template.slice(token[3],token[5]);value=value.call(context.view,text,function(template){return writer.render(template,context);});if(value!=null)buffer+=value;}else if(value){buffer+=renderTokens(token[4],writer,context,template);}
break;case'^':value=context.lookup(tokenValue);if(!value||(isArray(value)&&value.length===0)){buffer+=renderTokens(token[4],writer,context,template);}
break;case'>':value=writer.getPartial(tokenValue);if(typeof value==='function')buffer+=value(context);break;case'&':value=context.lookup(tokenValue);if(value!=null)buffer+=value;break;case'name':value=context.lookup(tokenValue);if(value!=null)buffer+=exports.escape(value);break;case'text':buffer+=tokenValue;break;}}
return buffer;}
function nestTokens(tokens){var tree=[];var collector=tree;var sections=[];var token;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];switch(token[0]){case'#':case'^':sections.push(token);collector.push(token);collector=token[4]=[];break;case'/':var section=sections.pop();section[5]=token[2];collector=sections.length>0?sections[sections.length-1][4]:tree;break;default:collector.push(token);}}
return tree;}
function squashTokens(tokens){var squashedTokens=[];var token,lastToken;for(var i=0,len=tokens.length;i<len;++i){token=tokens[i];if(token){if(token[0]==='text'&&lastToken&&lastToken[0]==='text'){lastToken[1]+=token[1];lastToken[3]=token[3];}else{lastToken=token;squashedTokens.push(token);}}}
return squashedTokens;}
function escapeTags(tags){return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))];}
exports.parse=function(template,tags){template=template||'';tags=tags||exports.tags;if(typeof tags==='string')tags=tags.split(spaceRe);if(tags.length!==2)throw new Error('Invalid tags: '+tags.join(', '));var tagRes=escapeTags(tags);var scanner=new Scanner(template);var sections=[];var tokens=[];var spaces=[];var hasTag=false;var nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length){delete tokens[spaces.pop()];}}else{spaces=[];}
hasTag=false;nonSpace=false;}
var start,type,value,chr,token;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(tagRes[0]);if(value){for(var i=0,len=value.length;i<len;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length);}else{nonSpace=true;}
tokens.push(['text',chr,start,start+1]);start+=1;if(chr=='\n')stripSpace();}}
if(!scanner.scan(tagRes[0]))break;hasTag=true;type=scanner.scan(tagRe)||'name';scanner.scan(whiteRe);if(type==='='){value=scanner.scanUntil(eqRe);scanner.scan(eqRe);scanner.scanUntil(tagRes[1]);}else if(type==='{'){value=scanner.scanUntil(new RegExp('\\s*'+escapeRe('}'+tags[1])));scanner.scan(curlyRe);scanner.scanUntil(tagRes[1]);type='&';}else{value=scanner.scanUntil(tagRes[1]);}
if(!scanner.scan(tagRes[1]))throw new Error('Unclosed tag at '+scanner.pos);token=[type,value,start,scanner.pos];tokens.push(token);if(type==='#'||type==='^'){sections.push(token);}else if(type==='/'){if(sections.length===0)throw new Error('Unopened section "'+value+'" at '+start);var openSection=sections.pop();if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start);}else if(type==='name'||type==='{'||type==='&'){nonSpace=true;}else if(type==='='){tags=value.split(spaceRe);if(tags.length!==2)throw new Error('Invalid tags at '+start+': '+tags.join(', '));tagRes=escapeTags(tags);}}
var openSection=sections.pop();if(openSection)throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);tokens=squashTokens(tokens);return nestTokens(tokens);};var _writer=new Writer();exports.clearCache=function(){return _writer.clearCache();};exports.compile=function(template,tags){return _writer.compile(template,tags);};exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags);};exports.compileTokens=function(tokens,template){return _writer.compileTokens(tokens,template);};exports.render=function(template,view,partials){return _writer.render(template,view,partials);};exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);if(typeof send==="function"){send(result);}else{return result;}};return exports;}())));;(function(exports){'use strict';var wrap=function(){return{};};if(typeof define==='function'&&define.amd){define(wrap);}
else{exports.Epitome=wrap(exports);}}(this));;(function(exports){'use strict';var wrap=function(){var eq=function(a,b,stack){stack=stack||[];if(a===b)return a!==0||1 / a==1 / b;if(a==null||b==null)return a===b;var typeA=typeOf(a),typeB=typeOf(b);if(typeA!=typeB)return false;switch(typeA){case'string':return a==String(b);case'number':return a!=+a?b!=+b:(a==0?1 / a==1 / b:a==+b);case'date':case'boolean':return+a==+b;case'regexp':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!=='object'||typeof b!=='object')return false;var length=stack.length;while(length--){if(stack[length]==a)return true;}
stack.push(a);var size=0,result=true;if(typeA=='array'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break;}}}else{if('constructor'in a!='constructor'in b||a.constructor!=b.constructor)return false;for(var key in a){if(a.hasOwnProperty(key)){size++;if(!(result=b.hasOwnProperty(key)&&eq(a[key],b[key],stack)))break;}}
if(result){for(key in b){if(b.hasOwnProperty(key)&&!(size--))break;}
result=!size;}}
stack.pop();return result;};return eq;};if(typeof define==='function'&&define.amd){define(['./epitome'],wrap);}
else{exports.Epitome||(exports.Epitome={});exports.Epitome.isEqual=wrap(exports.Epitome);}}(this));;(function(exports){'use strict';var wrap=function(isEqual){return new Class({Implements:[Options,Events],_attributes:{},properties:{id:{get:function(){var id=this._attributes.id||String.uniqueID();this.cid||(this.cid=id);return this._attributes.id;}}},validators:{},options:{defaults:{}},collections:[],initialize:function(obj,options){options&&options.defaults&&(this.options.defaults=Object.merge(this.options.defaults,options.defaults));obj=obj&&typeOf(obj)==='object'?obj:{};this.set(Object.merge(this.options.defaults,obj));this.setOptions(options);return this.fireEvent('ready');},set:function(){this.propertiesChanged=this.validationFailed=[];this._set.apply(this,arguments);this.propertiesChanged.length&&this.fireEvent('change',this.get(this.propertiesChanged));this.validationFailed.length&&this.fireEvent('error',[this.validationFailed]);},_set:function(key,value){if(!key||typeof value==='undefined')return this;if(this.properties[key]&&this.properties[key]['set'])
return this.properties[key]['set'].call(this,value);if(this._attributes[key]&&isEqual(this._attributes[key],value))
return this;var validator=this.validate(key,value);if(this.validators[key]&&validator!==true){var obj={};obj[key]={key:key,value:value,error:validator};this.validationFailed.push(obj);this.fireEvent('error:'+key,obj[key]);return this;}
if(value===null){delete this._attributes[key];}
else{this._attributes[key]=value;}
this.fireEvent('change:'+key,value);this.propertiesChanged.push(key);return this;}.overloadSetter(),get:function(key){if(key&&this.properties[key]&&this.properties[key]['get']){return this.properties[key]['get'].call(this);}
return(key&&typeof this._attributes[key]!=='undefined')?this._attributes[key]:null;}.overloadGetter(),unset:function(){var keys=Array.prototype.slice.apply(arguments),obj={},len=keys.length;if(!len)
return this;Array.each(Array.flatten(keys),function(key){obj[key]=null;});this.set(obj);return this;},toJSON:function(){return Object.clone(this._attributes);},empty:function(){var keys=Object.keys(this.toJSON()),self=this;this.fireEvent('change',[keys]);Array.each(keys,function(key){self.fireEvent('change:'+key,null);},this);this._attributes={};this.fireEvent('empty');},destroy:function(){this._attributes={};this.fireEvent('destroy');},validate:function(key,value){return(key in this.validators)?this.validators[key].call(this,value):true;}});};if(typeof define==='function'&&define.amd){define(['./epitome-isequal'],wrap);}
else{exports.Epitome||(exports.Epitome={isEqual:{}});exports.Epitome.Model=wrap(exports.Epitome.isEqual);}}(this));;(function(exports){'use strict';var EpitomeRequest=new Class({Extends:Request,options:{secure:true},initialize:function(options){this.parent(options);Object.append(this.headers,{'Accept':'application/json','X-Request':'JSON'});},success:function(text){var json;try{json=this.response.json=JSON.decode(text,this.options.secure);}catch(error){this.fireEvent('error',[text,error]);return;}
if(text&&(json==null&&this.status!=204))this.onFailure();else this.onSuccess(json,text);}});var wrap=function(Model){var syncPseudo='sync:';var methodMap={'create':'POST','read':'GET','update':'PUT','delete_':'DELETE'};return new Class({Extends:Model,properties:{urlRoot:{set:function(value){this.urlRoot=value;delete this._attributes['urlRoot'];},get:function(){var base=this.urlRoot||this.options.urlRoot||'no-urlRoot-set';base.charAt(base.length-1)!='/'&&(base+='/');return base;}}},options:{emulateREST:false,useJSON:false},initialize:function(obj,options){this.setupSync();this.parent(obj,options);},sync:function(method,model){var options={};method=method&&methodMap[method]?methodMap[method]:methodMap['read'];options.method=method;if(method==methodMap.create||method==methodMap.update){options.data=model||this.toJSON();this.preProcessor&&(options.data=this.preProcessor(options.data));}
if(this.options.useJSON&&['POST','PUT','DELETE'].contains(method)){options.data=JSON.encode(options.data);options.urlEncoded=false;this.request.setHeader('Content-type','application/json');}
else{options.urlEncoded=true;}
options.url=[this.get('urlRoot'),this.get('id')].join('');options.url.slice(-1)!=='/'&&(options.url+='/');this.request.setOptions(options);this.request[method](model);return this;},setupSync:function(){var self=this,rid=0,incrementRequestId=function(){rid++;};this.getRequestId=function(){return rid+1;};this.request=new EpitomeRequest({link:'chain',url:this.get('urlRoot'),emulation:this.options.emulateREST,onRequest:incrementRequestId,onCancel:function(){this.removeEvents(syncPseudo+rid);},onSuccess:function(responseObj){responseObj=self.postProcessor&&self.postProcessor(responseObj);self.fireEvent(syncPseudo+rid,[responseObj]);self.fireEvent('sync',[responseObj,this.options.method,this.options.data]);self.isNewModel=false;},onFailure:function(){self.fireEvent(syncPseudo+'error',[this.options.method,this.options.url,this.options.data]);self.fireEvent('requestFailure',[this.status,this.response.text]);}});Object.each(methodMap,function(requestMethod,protoMethod){self[protoMethod]=function(model){this.sync(protoMethod,model);};});return this;},_throwAwaySyncEvent:function(eventName,callback){eventName=eventName||syncPseudo+this.getRequestId();var self=this,throwAway={};throwAway[eventName]=function(responseObj){if(responseObj&&typeof responseObj=='object'){self.set(responseObj);}
callback&&callback.call(self,responseObj);self.removeEvents(throwAway);};return this.addEvents(throwAway);}.protect(),postProcessor:function(resp){return resp;},preProcessor:function(data){return data;},fetch:function(){this._throwAwaySyncEvent(syncPseudo+this.getRequestId(),function(){this.fireEvent('fetch');this.isNewModel=false;});this.read();return this;},save:function(key,value){var method=['update','create'][+this.isNew()];if(key){var ktype=typeOf(key),canSet=ktype=='object'||(ktype=='string'&&typeof value!='undefined');canSet&&this._set.apply(this,arguments);}
this._throwAwaySyncEvent(syncPseudo+this.getRequestId(),function(){this.fireEvent('save');this.fireEvent(method);});this[method]();return this;},destroy:function(){this._throwAwaySyncEvent(syncPseudo+this.getRequestId(),function(){this._attributes={};this.fireEvent('destroy');});this.delete_();},isNew:function(){if(typeof this.isNewModel==='undefined'){this.isNewModel=!this.get('id');}
return this.isNewModel;}});};if(typeof define==='function'&&define.amd){define(['./epitome-model'],wrap);}
else{exports.Epitome||(exports.Epitome={Model:{}});exports.Epitome.Model.Sync=wrap(exports.Epitome.Model);}}(this));;(function(exports){'use strict';var wrap=function(model){var methodMap=['forEach','each','invoke','filter','map','some','indexOf','contains','getRandom','getLast'];Function.extend({monitorModelEvents:function(listener,orig){var self=this;orig=orig||this;if(!(listener&&listener.fireEvent&&!listener.hasOwnProperty('fireEvent')))
return this;return function(type,args,delay){self.apply(orig,arguments);listener.getModelByCID(orig.cid)&&listener.fireEvent(type,Array.flatten([orig,args]),delay);};}});var collection=new Class({Implements:[Options,Events],model:model,_models:[],initialize:function(models,options){this.setOptions(options);models&&this.setUp(models);this.id=this.options.id||String.uniqueID();return this.fireEvent('ready');},setUp:function(models){models=Array.from(models);Array.each(models,this.addModel.bind(this));this.addEvent('destroy',this.removeModel.bind(this));return this;},addModel:function(model,replace){var exists;if(typeOf(model)=='object'&&!instanceOf(model,this.model)){model=new this.model(model);}
model.cid=model.cid||model.get('id')||String.uniqueID();exists=this.getModelByCID(model.cid);if(exists&&replace!==true)
return this.fireEvent('add:error',model);exists&&replace===true&&(this._models[this._models.indexOf(exists)]=model);model.fireEvent=Function.monitorModelEvents.apply(model.fireEvent,[this,model]);if(!exists){this._models.push(model);}
model.collections.include(this);this.length=this._models.length;return this.fireEvent('add',[model,model.cid]).fireEvent('reset',[model,model.cid]);},removeModel:function(models,quiet){var self=this;models=Array.from(models).slice();Array.each(models,function(model){model.collections.erase(self);model.collections.length||delete model.fireEvent;Array.erase(self._models,model);self.length=self._models.length;quiet||self.fireEvent('remove',[model,model.cid]);});return this.fireEvent('reset',[models]);},get:function(what){return this[what];},getModelByCID:function(cid){var last=null;this.some(function(el){return el.cid==cid&&(last=el);});return last;},getModelById:function(id){var last=null;this.some(function(el){return el.get('id')==id&&(last=el);});return last;},getModel:function(index){return this._models[index];},toJSON:function(){var getJSON=function(model){return model.toJSON();};return Array.map(this._models,getJSON);},empty:function(quiet){this.removeModel(this._models,quiet);return this.fireEvent('empty');},sort:function(how){if(!how){this._models.sort();return this.fireEvent('sort');}
if(typeof how==='function'){this.model.sort(how);return this.fireEvent('sort');}
var type='asc',conds=how.split(','),c=function(a,b){if(a<b)
return-1;if(a>b)
return 1;return 0;};this._models.sort(function(a,b){var ret=0;Array.some(conds,function(cond){cond=cond.trim();var pseudos=cond.split(':'),key=pseudos[0],sortType=(pseudos[1])?pseudos[1]:type,ak=a.get(key),bk=b.get(key),cm=c(ak,bk),map={asc:cm,desc:-(cm)};if(typeof map[sortType]=='undefined'){sortType=type;}
ret=map[sortType];return ret!=0;});return ret;});return this.fireEvent('sort');},reverse:function(){Array.reverse(this._models);return this.fireEvent('sort');},find:function(expression){var parsed=exports.Slick.parse(expression),exported=[],found=this,map={'=':function(a,b){return a==b;},'!=':function(a,b){return a!=b;},'^=':function(a,b){return a.indexOf(b)===0;},'*=':function(a,b){return a.indexOf(b)!==-1;},'$=':function(a,b){return a.indexOf(b)==a.length-b.length;},'*':function(a){return typeof a!=='undefined';}},fixOperator=function(operator){return(!operator||!map[operator])?null:map[operator];},finder=function(attributes){var attr=attributes.key,value=attributes.value||null,tag=attributes.tag||null,operator=fixOperator(attributes.operator);found=found.filter(function(el){var t,a;if(tag&&attr){t=el.get(tag);a=t?t[attr]:null;}
else if(tag){a=el.get(tag);}
else{a=el.get(attr);}
if(a!==null&&value!==null&&operator!==null)
return operator(a,value);return a!=null;});};if(parsed.expressions.length){var j,i;var attributes;var currentExpression,currentBit,expressions=parsed.expressions,id,t,tag;search:for(i=0;(currentExpression=expressions[i]);i++){for(j=0;(currentBit=currentExpression[j]);j++){attributes=currentBit.attributes;id=currentBit.id;if(id){t={key:'id',value:id,operator:'='};attributes||(attributes=[]);attributes.push(t);}
tag=currentBit.tag;if(tag&&tag!='*'){attributes||(attributes=[{key:null,value:'',operator:'*'}]);attributes=Array.map(attributes,function(a){a.tag=tag;return a;});}
if(!attributes)continue search;Array.each(attributes,finder);}
exported[i]=found;found=this;}}
return[].combine(Array.flatten(exported));},findOne:function(expression){var results=this.find(expression);return results.length?results[0]:null;}});Array.each(methodMap,function(method){collection.implement(method,function(){return Array.prototype[method].apply(this._models,arguments);});});return collection;};if(typeof define==='function'&&define.amd){define(['./epitome-model'],wrap);}
else{exports.Epitome||(exports.Epitome={Model:{}});exports.Epitome.Collection=wrap(exports.Epitome.Model);}}(this));;(function(exports){'use strict';var wrap=function(Collection){var noUrl='no-urlRoot-set',eventPseudo='fetch:';return new Class({Extends:Collection,options:{urlRoot:noUrl},initialize:function(models,options){this.setupSync();this.parent(models,options);},setupSync:function(){var self=this,rid=0,incrementRequestId=function(){rid++;};this.getRequestId=function(){return rid+1;};this.request=new Request.JSON({link:'chain',url:this.options.urlRoot,emulation:this.options.emulateREST,onRequest:incrementRequestId,onCancel:function(){this.removeEvents(eventPseudo+rid);},onSuccess:function(responseObj){responseObj=self.postProcessor&&self.postProcessor(responseObj);self.fireEvent(eventPseudo+rid,[[responseObj]]);},onFailure:function(){self.fireEvent(eventPseudo+'error',[this.options.method,this.options.url,this.options.data]);}});return this;},parse:function(resp){return resp;},fetch:function(refresh,queryParams){queryParams||(queryParams={});this._throwAwayEvent(function(models){if(refresh){this.empty();Array.each(models,this.addModel.bind(this));}
else{this.processModels(models);}
this.fireEvent('fetch',[models])});this.request.get(queryParams);return this;},processModels:function(models){var self=this;Array.each(models,function(model){var exists=model.id&&self.getModelById(model.id);if(exists){exists.set(model);}
else{self.addModel(model);}});},_throwAwayEvent:function(callback){var eventName=eventPseudo+this.getRequestId(),self=this,throwAway={};if(!callback||typeof callback!=='function')
return;throwAway[eventName]=function(responseObj){callback.apply(self,responseObj);self.removeEvents(throwAway);};return this.addEvents(throwAway);}.protect(),postProcessor:function(jsonResponse){return jsonResponse;}});};if(typeof define==='function'&&define.amd){define(['./epitome-collection'],wrap);}
else{exports.Epitome||(exports.Epitome={Collection:{}});exports.Epitome.Collection.Sync=wrap(exports.Epitome.Collection);}}(this));;(function(exports){'use strict';(function(){var escapes={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','/':'&#x2F;'},escaper=new RegExp('['+Object.keys(escapes).join('')+']','g');String.implement({escape:function(){return String(this).replace(escaper,function(match){return escapes[match];});}});}());var wrap=function(){return new Class({options:{evaluate:/<%([\s\S]+?)%>/g,normal:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g,noMatch:/.^/,escaper:/\\|'|\r|\n|\t|\u2028|\u2029/g},Implements:[Options],initialize:function(options){this.setOptions(options);var escapes=this.escapes={'\\':'\\',"'":"'",'r':'\r','n':'\n','t':'\t','u2028':'\u2028','u2029':'\u2029'};Object.each(escapes,function(value,key){this[value]=key;},escapes);this.matcher=new RegExp([(this.options.escape||this.options.noMatch).source,(this.options.normal||this.options.noMatch).source,(this.options.evaluate||this.options.noMatch).source].join('|')+'|$','g');return this;},template:function(text,data,options){var o=options?Object.merge(this.options,options):this.options,render,escapes=this.escapes,escaper=o.escaper,index=0,source="__p+='";text.replace(this.matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return'\\'+escapes[match];});if(escape){source+="'+\n((__t=(obj['"+escape+"']))==null?'':String.escape(__t))+\n'";}
if(interpolate){source+="'+\n((__t=(obj['"+interpolate+"']))==null?'':__t)+\n'";}
if(evaluate){source+="';\n"+evaluate+"\n__p+='";}
index=offset+match.length;return match;});source+="';\n";if(!o.variable)source='obj=obj||{};with(obj){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+
source+"return __p;\n";try{render=new Function(o.variable||'obj',source);}catch(e){e.source=source;throw e;}
if(data)return render(data);var template=function(data){return render.call(this,data);};template.source='function('+(o.variable||'obj')+'){\n'+source+'}';return template;}});};if(typeof define==='function'&&define.amd){define(['./epitome'],wrap);}
else{exports.Epitome||(exports.Epitome={});exports.Epitome.Template=wrap(exports.Epitome);}}(this));;(function(exports){var wrap=function(Template,Model,Collection){return new Class({Implements:[Options,Events],element:null,collection:null,model:null,options:{template:"",events:{}},initialize:function(options){if(options&&options.collection){this.setCollection(options.collection);delete options.collection;}
if(options&&options.model){this.setModel(options.model);delete options.model;}
this.setOptions(options);if(this.options.element){this.setElement(this.options.element,this.options.events);delete this.options.element;}
return this.fireEvent('ready');},setElement:function(el,events){this.element&&this.detachEvents()&&this.destroy();this.element=document.id(el);events&&this.attachEvents(events);return this;},setCollection:function(collection){var self=this,eventProxy=function(type){return function(){self.fireEvent(type+':collection',arguments);}};if(instanceOf(collection,Collection)){this.collection=collection;this.collection.addEvents({'change':eventProxy('change'),'fetch':eventProxy('fetch'),'add':eventProxy('add'),'remove':eventProxy('remove'),'sort':eventProxy('sort'),'reset':eventProxy('reset'),'error':eventProxy('error')});}
return this;},setModel:function(model){var self=this,eventProxy=function(type){return function(){self.fireEvent(type+':model',arguments);}};if(instanceOf(model,Model)){this.model=model;this.model.addEvents({'change':eventProxy('change'),'destroy':eventProxy('destroy'),'empty':eventProxy('empty'),'error':eventProxy('error')});}
return this;},attachEvents:function(events){var self=this;Object.each(events,function(method,type){self.element.addEvent(type,function(e){self.fireEvent(method,arguments);});});this.element.store('attachedEvents',events);return this;},detachEvents:function(){var events=this.element.retrieve('attachedEvents');events&&this.element.removeEvents(events).eliminate('attachedEvents');return this;},template:function(data,template){template=template||this.options.template;var compiler=this.Template||(this.Template=new Template());return compiler.template(template,data);},render:function(){return this.fireEvent('render');},empty:function(soft){if(soft){this.element.empty();}
else{this.element.set('html','');}
return this.fireEvent('empty');},dispose:function(){this.element.dispose();return this.fireEvent('dispose');},destroy:function(){this.element.destroy();return this.fireEvent('destroy');}});};if(typeof define==='function'&&define.amd){define(['./epitome-template','./epitome-model','./epitome-collection'],wrap);}
else{exports.Epitome||(exports.Epitome={Template:{},Model:{},Collection:{}});exports.Epitome.View=wrap(exports.Epitome.Template,exports.Epitome.Model,exports.Epitome.Collection);}}(this));;(function(exports){'use strict';var wrap=function(Model){return new Class({Extends:Model,config:compojoom.ccomment.config,properties:{name:{get:function(){var name,config=this.config;name=config._use_name?this._attributes.name:this._attributes.username;if(!name){name=Cookie.read('compojoom.ccomment.user.name');}
if(this._attributes.loggedin){Cookie.dispose('compojoom.ccomment.user.name');}
return name;},set:function(name){var config=this.config;if(!this._attributes.loggedin){Cookie.write('compojoom.ccomment.user.name',name);if(config._user_name){this._attributes.name=name}else{this._attributes.username=name;}}}},avatar:{get:function(){var avatar=this._attributes.avatar,email=this.get('email'),config=this.config;if(!this._attributes.loggedin){if(config.gravatar){if(email){avatar='http://www.gravatar.com/avatar/'+email.toMD5();}}}
return avatar;}},email:{get:function(){var email=this._attributes.email;if(!email){email=Cookie.read('compojoom.ccomment.user.email');}
if(this._attributes.loggedin){Cookie.dispose('compojoom.ccomment.user.email');}
return email;},set:function(email){if(email){Cookie.write('compojoom.ccomment.user.email',email);this._attributes.email=email;}}}},options:{defaults:{username:'',email:'',notify:1,loggedin:0,avatar:''}},getName:function(){return this.get('name');},getDefaultName:function(){var name=this.get('name');if(!name){name=Joomla.JText._('COM_COMMENT_ANONYMOUS','Anonymous');}
return name;},getAvatar:function(){return this.get('avatar');},getEmail:function(){return this.get('email');}});};if(typeof define==='function'&&define.amd){define(['epitome/epitome-model'],wrap);}
else{exports.Ccomment||(exports.Ccomment={});exports.Ccomment.User=wrap(Epitome.Model);}}(this));;(function(exports){'use strict';var wrap=function(ModelSync){var methodMap={'create':'POST','read':'GET','update':'POST','delete_':'GET'};return new Class({Extends:ModelSync,options:{defaults:{name:'anonymous',comment:'',votes:0,commentLevel:function(){return this.level<compojoom.ccomment.config.tree_depth;}},emulateREST:false,useJSON:false},sync:function(method,model){var options={};method=method&&methodMap[method]?methodMap[method]:methodMap['read'];options.method=method;if(method==methodMap.create||method==methodMap.update){options.data=model||this.toJSON();this.preProcessor&&(options.data=this.preProcessor(options.data));}
options.url=this.options.url;this.request.setOptions(options);this.request[method](model);return this;},preProcessor:function(data){var filteredData={};Object.each(data,function(value,key){if(key.indexOf('customfields')!==-1){filteredData[key]=value;}else{filteredData['jform['+key+']']=value;}});return filteredData;}});};if(typeof define==='function'&&define.amd){define(['epitome/epitome-model-sync'],wrap);}
else{exports.Ccomment||(exports.Ccomment={});exports.Ccomment.Comment=wrap(Epitome.Model.Sync);}}(this));;(function(exports){'use strict';var wrap=function(Collection,Model){return new Class({Extends:Collection,model:Model,options:{urlRoot:compojoom.ccomment.config.baseUrl+'?option=com_comment&task=comments.getcomments&format=json&contentid='+compojoom.ccomment.item.contentid+'&component='+compojoom.ccomment.item.component},getParent:function(model){var parentId=model.get('parent_id');return this.findOne('#'+parentId);},postProcessor:function(json){if(json.info){this.info=json.info;json=json.models;}
return json;}});};if(typeof define==='function'&&define.amd){define(['epitome/epitome-collection-sync','models/comment'],wrap);}
else{exports.Ccomment||(exports.Ccomment={});exports.Ccomment.Comments=wrap(Epitome.Collection.Sync,exports.Ccomment.Comment);}}(this));;(function(exports){'use strict';var wrap=function(View){return new Class({Extends:View,options:{events:{'click:relay(.ccomment-pagination a)':'changePage'},itemsPerPage:10,total:100,maxPages:5,startPage:1,container:'.pagination',onChangePage:function(e,el){this.render(el.get('data-id'));}},initialize:function(options){this.parent(options);this.render(this.options.startPage);},render:function(start){var pages=Math.ceil(this.options.total / this.options.itemsPerPage),container=new Element('div'),i;start=(start)?start.toInt():1;if(pages>1){var prev=start-1?start-1:1;new Element('a',{'html':'«','data-id':prev,'class':start==1?'disabled':'',href:'#!/ccomment-page='+((start==1)?'1':prev)}).inject(container);if(pages<=6){for(i=1;i<=pages;i++){new Element('a',{html:i,href:'#!/ccomment-page='+i,'data-id':i,'class':i==start?'active':''}).inject(container);}}else{if(start==1||((start-1)<=3)){for(i=1;i<=5;i++){new Element('a',{html:i,href:'#!/ccomment-page='+i,'data-id':i,'class':i==start?'active':''}).inject(container);}
new Element('span',{html:'...'}).inject(container);new Element('a',{html:pages,href:'#!/ccomment-page='+pages,'data-id':pages}).inject(container);}else if((start-1)>3&&pages-start>3){new Element('a',{html:1,href:'#!/ccomment-page=1','data-id':1}).inject(container);new Element('span',{html:'...'}).inject(container);i=start-2;var end=start+2;for(i;i<=end;i++){new Element('a',{html:i,href:'#!/ccomment-page='+i,'class':i==start?'active':'','data-id':i}).inject(container);}
new Element('span',{html:'...'}).inject(container);new Element('a',{html:pages,href:'#!/ccomment-page='+pages,'data-id':pages}).inject(container);}else{new Element('a',{html:1,href:'#!/ccomment-page='+1,'data-id':1}).inject(container);new Element('span',{html:'...'}).inject(container);for(i=pages-4;i<=pages;i++){new Element('a',{html:i,href:'#!/ccomment-page='+i,'data-id':i,'class':i==start?'active':''}).inject(container);}}}
var next=(start==pages)?start:start.toInt()+1;new Element('a',{'html':'»','data-id':next,'class':(start.toInt()+1>pages)?'disabled':'',href:'#!/ccomment-page='+((start.toInt()+1>pages)?pages:next)}).inject(container);}
$$(this.options.container).set('html',container.get('html'));}});};if(typeof define==='function'&&define.amd){define(['epitome/epitome-view'],wrap);}
else{exports.Ccomment||(exports.Ccomment={});exports.Ccomment.Pagination=wrap(Epitome.View);}}(this));;(function(exports){'use strict';var wrap=function(){return new Class({Implements:[Options],options:{container:'ccomment',type:'ubb'},initialize:function(options){this.setOptions(options);this.container=document.id(this.options.container);this.start();},start:function(){var self=this;this.container.addEvent('click:relay(.ccomment-ubb-container span.ccomment-ubb)',function(){self.insertTag(this);});this.container.addEvent('change:relay(.ccomment-ubb-container select)',function(){self.insertSelect(this);});this.container.addEvent('click:relay(.ccomment-emoticons span)',function(){self.insertTag(this);});},insertTag:function(el){this.insert(el.get('data-open'),el.get('data-close')?el.get('data-close'):'',el);},insertSelect:function(el){var selected=el.getSelected();this.insert(selected.get('data-open'),selected.get('data-close'),el);},insert:function(open,close,el){var txtarea=el.getParent('form').getElement('textarea'),selLength=txtarea.textLength,selStart=txtarea.selectionStart,selEnd=txtarea.selectionEnd,s1=(txtarea.value).substring(0,selStart),s2=(txtarea.value).substring(selStart,selEnd),s3=(txtarea.value).substring(selEnd,selLength);if(open=="[url="){if(s2.substring(7,4)!="://"){s2="http://"+s2;}}
txtarea.value=s1+open+s2+close+s3;txtarea.selectionStart=selStart+(open.length+s2.length+close.length);txtarea.selectionEnd=txtarea.selectionStart;txtarea.focus();}});};if(typeof define==='function'&&define.amd){define(wrap);}
else{exports.Ccomment||(exports.Ccomment={});exports.Ccomment.UbbCode=wrap();}}(this));;(function(exports){var wrap=function(View,CommentModel,userModel,Mustache,pagination,ubb){'use strict';return new Class({Implements:[Options],Extends:View,user:new userModel(compojoom.ccomment.user),config:compojoom.ccomment.config,item:compojoom.ccomment.item,captchas:[],options:{events:{'click:relay(button.ccomment-send)':'processCommentForm','click:relay(button.btn-ccomment-change-state)':'changeState','focus:relay(.ccomment-textarea)':'textarea','click:relay(.ccomment-voting)':'voting','click:relay(.ccomment-posting-as)':'userInfo','click:relay(.ccomment-notify input)':'notify','input:relay(.ccomment-form)':'input','click:relay(.ccomment-cancel)':'cancel','click:relay(.ccomment-quote)':'quote','click:relay(.btn-ccomment-edit)':'edit','click:relay(.ccomment-reply)':'reply','click:relay(.ccomment-add-new)':'addNew','click:relay(.ccomment-toggle-emoticons)':'toggleEmoticons'},onToggleEmoticons:function(e,el){el.getParent('form').getElement('div.ccomment-emoticons').toggleClass('hide');},onAddNew:function(){var form=this.element.getElements('.ccomment-form').pop();new Fx.Scroll(window).toElement(form).addEvent('complete',function(){form.getElement('textarea').focus();});},onReply:function(e,el){var form=el.retrieve("element");if(!form){var id=el.getParent('li').get('data-id'),parent=new Element('input',{type:'hidden',name:'parentid',value:id});form=this.createForm();parent.inject(form);form.inject(el.getParent('li').getFirst('div'),'after');el.store("element",form);}else{form.toggle();}
if(form.getStyle('display')==='block'){form.getElement('textarea').focus();}},onEdit:function(e,el){var id=el.getParent('li').get('data-id'),model=this.collection.getModelById(id),user=this.user,form=el.getParent('li').getChildren('form')[0];model.setOptions({'url':this.config.baseUrl+'?option=com_comment&task=comment.edit&format=json&id='+id+'&'+this.getToken()+'=1&component='+this.item.component});if(!form){form=this.element.getElement('form.ccomment-form');}else{form.setStyle('display','block');}
model.addEvent('sync',function(comment){if(comment!=undefined){if(comment.name==''){comment.name='COM_COMMENT_ANONYMOUS';}
form['comment'].value=comment.comment;form['notify'].checked=(comment.notify).toInt()?true:false;if(form.getElement('input[name=id]')){form.getElement('input[name=id]').set('value',comment.id);}else{new Element('input',{'type':'hidden','value':comment.id,name:'id'}).inject(form);}
comment.customfields.each(function(field){var formField=form.getElement('[name="jform[customfields]['+field.name+']"]');if(formField){formField.value=field.value;}});}else{form['comment'].value+='failed to fetch comment';}
form['comment'].focus();form.getElement('textarea').retrieve('dynamictextarea').checkSize(true);});model.read();new Fx.Scroll(window).toElement(form);},onQuote:function(e,el){var id=el.getParent('li').get('data-id'),model=this.collection.getModelById(id),form=el.getParent('li').getChildren('form')[0];model.setOptions({'url':this.config.baseUrl+'?option=com_comment&task=comment.quote&format=json&id='+id});if(!form){form=this.element.getElement('form.ccomment-form');}else{form.setStyle('display','block');}
model.addEvent('sync:once',function(comment){if(comment!=undefined){if(comment.name==''){comment.name='COM_COMMENT_ANONYMOUS';}
form['comment'].value+='[quote='+comment.name+']'+comment.comment+'[/quote]';}else{form['comment'].value+='failed to fetch comment';}
form.getElement('textarea').focus();form.getElement('textarea').retrieve('dynamictextarea').checkSize(true);});model.fetch();new Fx.Scroll(window).toElement(form);},onCancel:function(e,el){e.stop();this.closeForm(el);},onInput:function(e,el){var name=e.target.get('name'),self=this;var options={name:function(){var name=e.target.value;self.user.set('name',name);self.element.getElements('.ccomment-posting-as').set('html',self.user.getDefaultName());},email:function(){self.user.set('email',e.target.value);self.element.getElements('.ccomment-avatar-form').set('src',self.user.get('avatar'));}};options[name]&&options[name]();},onVoting:function(e,el){var id=el.getParent('li').get('data-id'),vote=el.get('data-vote').toInt(),model=this.collection.getModelById(id),user=this.user,self=this;model.setOptions({'url':self.config.baseUrl+'?option=com_comment&task=comment.vote&vote='+vote+'&id='+id+'&format=json&'+this.getToken()+'=1'});model.addEvent('sync',function(response){model.set('votes',response.votes);self.collection.addModel(model);});model.save();},onNotify:function(e,el){if(el.get('checked')){$$('.ccomment-form div.ccomment-user-info').removeClass('hide');}else{$$('.ccomment-form div.ccomment-user-info').addClass('hide');}},onUserInfo:function(e,el){e.stop();el.getParent('form').getElements('div.ccomment-user-info').toggleClass('hide');},onTextarea:function(e,el){var form=el.getParent('form'),name=form.getElement('.ccomment-name'),email=form.getElement('.ccomment-email');if(form.getElement('.ccomment-form-ubb')){if(form.getElement('.ccomment-form-ubb').getStyle('display')!='block'){form.getElement('.ccomment-form-ubb').setStyles({'display':'block','opacity':0}).fade('in');el.setStyles({'border-radius':'3px 3px 0 0'});}}
form.getElements('div.ccomment-actions.hide').toggleClass('hide');if(typeof this.config.captcha_pub_key!=='undefined'){var recaptchaPlaceholder=el.getParent('form').getElement('.ccomment-recaptcha-placeholder');if(!recaptchaPlaceholder.get('html').trim())
{this.captchas.push(grecaptcha.render(el.getParent('form').getElement('.ccomment-recaptcha-placeholder'),{sitekey:this.config.captcha_pub_key}));}}
if((!this.user.getName()&&(name&&name.hasClass('required')))||(!this.user.getEmail()&&(email&&email.hasClass('required')))){form.getElement('.ccomment-user-info').removeClass('hide');}},onChangeState:function(e,el){var id=el.getParent('li').get('data-id'),action=el.get('data-action'),user=this.user,model=this.collection.findOne('#'+id),self=this,url=self.config.baseUrl+'?option=com_comment&task=comment.changestate&id='+id+'&format=json&'+this.getToken()+'=1';if(action==='delete'){url+='&state=-1';}else if(action==='publish'){url+='&state=1';}else if(action==='unpublish'){url+='&state=0';}
model.setOptions({url:url});model.addEvent('sync',function(response){if(response.status==='success'){if(action==='delete'){self.collection.removeModel(model);}else{model.set('published',(action==='publish')?1:0);self.collection.addModel(model);}
self.buildCommentsList(self.element.getElement('.ccomment-comments-list'));}});if(action==='delete'){model&&model.destroy();}else{model.create();}},onProcessCommentForm:function(e,el){e&&e.stop&&e.stop();this.processCommentForm(el);},'onFetch:collection':function(){var info=this.collection.info;if(info.total){this.buildCommentsList(this.element.getElement('.ccomment-comments-list'));this.createPagination(info.page,info.countParents);}
if(location.hash.indexOf('#!/ccomment-comment=')===0){var comment=location.hash.replace('#!/ccomment-comment=','');new Fx.Scroll(window).toElement(document.id('ccomment-'+comment));}},'onChange:collection':function(){this.buildCommentsList(this.element.getElement('.ccomment-comments-list'));},onReady:function(){new Ccomment.UbbCode({container:this.element});this.render();}},template:function(data,template,partial){template=template||this.options.template;return Mustache.render(template,data,partial);},render:function(){this.formTemplate=document.id('ccomment-form-template');this.commentTemplate=document.id('ccomment-comment-template');this.menuTemplate=document.id('ccomment-menu-template');this.element.set('html',this.template({comment_count:this.item.count}));if(this.config.comments_per_page){if(this.config.pagination_position==1||this.config.pagination_position==2){new Element('div',{'class':'hide pagination pagination-mini ccomment-pagination ccomment-pagination-top'}).inject(this.element,'top');}
if(this.config.pagination_position==0||this.config.pagination_position==2){new Element('div',{'class':'hide pagination pagination-mini ccomment-pagination ccomment-pagination-bottom'}).inject(this.element);}}
this.createForm().inject(this.element,this.config.form_position?'top':'bottom');new Element('div',{html:this.template({comment_count:this.item.count},this.menuTemplate.get('html'))}).inject(this.element,'top');if(this.config.copyright){new Element('div',{html:this.template({},document.id('ccomment-footer-template').get('html'))}).inject(this.element);}
if(location.hash.indexOf('#!/ccomment')===0){new Fx.Scroll(window).toElement(this.element);}
this.parent();},createPagination:function(start,total){if(this.config.comments_per_page){var self=this;if(total>self.config.comments_per_page){self.element.getElements('.pagination').removeClass('hide');}
new pagination({container:'.ccomment-pagination',total:total,itemsPerPage:self.config.comments_per_page,startPage:start,element:self.element}).addEvent('changePage',function(e,el){var page=el.get('data-id');self.collection.fetch(true,{start:page});});}},createForm:function(){var formValues={info:compojoom.ccomment.item,user:this.user},form=new Element('form',{html:this.template(formValues,this.formTemplate.get('html')),'class':'ccomment-form control-group ccomment-new-comment'});var textarea=form.getElement('.ccomment-textarea');if(textarea){textarea.store('dynamictextarea',new DynamicTextarea(textarea));}
new PlaceholderSupport(form.getElements('input[placeholder],textarea[placeholder]'));return form;},buildCommentsList:function(root){var commentEl=document.id(root),comments=this.collection.toJSON(),self=this;commentEl.empty();comments.each(function(comment){self.positionComment(comment,commentEl)});},positionComment:function(comment,target,position){if(typeof(position)==='undefined')position='bottom';var template=this.commentTemplate.get('html'),li=new Element('li',{html:this.template(comment,template),'class':comment['class']+(comment.published.toInt()?' ccomment-published':' ccomment-unpublished'),'data-id':comment.id});if(comment.parentid.toInt()===-1||!this.config.tree.toInt()){li.inject(target,position);}
else{var parentLi=target.getElement('#ccomment-'+comment.parentid).getParent('li'),replies=parentLi.getChildren('ul.ccomment-replies')[0],ul=new Element('ul',{'class':'ccomment-replies ccomment-children-of-'+comment.parentid});if(!replies){li.inject(ul.inject(parentLi)||target);}else{li.inject(replies)}}},closeForm:function(el){var form=el.getParent('form'),li=form.getParent('li');form.reset();form.getElement('.ccomment-form-ubb')&&form.getElement('.ccomment-form-ubb').setStyle('display','none');form.getElements('div.ccomment-actions').addClass('hide');form.getElements('div.ccomment-user-info').addClass('hide');form.getElement('input[name=id]')&&form.getElement('input[name=id]').destroy();li&&li.getElement('.ccomment-reply').retrieve('element').toggle();},processCommentForm:function(el){var obj={},self=this,goTo=self.element.getElement('.ccomment-comments-list'),id,user=this.user,errorEl=self.element.getChildren('.ccomment-form')[0].getElement('.ccomment-error-form'),formValidator=new Form.Validator(el.getParent('form')),counter=0;formValidator.add('nonEmpty',{errorMsg:'This field is required',test:function(element){return element.value.trim().length!=0;}});if(el.get('disabled')){return;}
formValidator.addEvent('elementFail',function(element,validators){if(validators.contains('required')){errorEl.removeClass('hide');errorEl.getElement('div').set('html',self.translate('COM_COMMENT_PLEASE_FILL_IN_ALL_REQUIRED_FIELDS','Please fill in all required fields'));}});if(formValidator.validate()){el.set('html',el.get('data-message-disabled'));el.set('disabled','true');el.getParent('form').getElements('input,textarea,select').each(function(input){if(input.get('type')!=='checkbox'){obj[input.get('name')]=input.get('value');}else{if(input.get('checked')){obj[input.get('name')]=1;}}});obj.page=this.collection.info.page;errorEl.addClass('hide');var m=new CommentModel(obj,{url:self.config.baseUrl+'?option=com_comment&task=comment.insert&format=json&'+this.getToken()+'=1'});id=m.get('id');m.addEvent('sync',function(response,method){var rerender=false,position=(self.config.sort==1||self.config.sort==2)?'top':'bottom';el.set('html',el.get('data-message-enabled'));el.removeProperty('disabled');if(response.info){var info=response.info;self.collection.info=response.info;self.collection.empty();self.collection.setUp(response.models);self.buildCommentsList(self.element.getElement('.ccomment-comments-list'));location.hash='#!/ccomment-page='+info.page;self.createPagination(info.page,info.countParents);self.closeForm(el);counter=info.total;}else{self.captchas.each(function(captcha){grecaptcha.reset(captcha);});if(response.status=='error'){errorEl.getElement('div').set('html',response.message);errorEl.removeClass('hide');return;}else if(response.status=='info'){var divEl=errorEl.getElement('div');divEl.set('html',response.message);divEl.removeClass('alert-error').addClass('alert-info');errorEl.removeClass('hide');self.closeForm(el);new Fx.Scroll(window).toElement(divEl);return;}else{rerender=self.collection.getModelById(response.id)?true:false;self.collection.addModel(response,true);if(rerender){self.buildCommentsList(self.element.getElement('.ccomment-comments-list'));}else{if(self.collection.length===1){self.buildCommentsList(self.element.getElement('.ccomment-comments-list'));}else{self.positionComment(response,self.element.getElement('.ccomment-comments-list'),position);}}
self.createPagination(self.collection.info.page,self.collection.info.countParents);if(!response.info){goTo=document.id('ccomment-'+response.id);}
self.closeForm(el);counter=self.collection.info.total.toInt()+1;}}
new Fx.Scroll(window).toElement(goTo);self.element.getElement('.ccomment-menu').getParent('div').set('html',self.template({comment_count:counter},self.menuTemplate.get('html')));});m.save();}},getToken:function(){return document.id('ccomment-token').getElement('input').get('name');},translate:function(key,def){return Joomla.JText._(key,def);}});};if(typeof define==='function'&&define.amd){define(['epitome/epitome-view','models/comment','models/user','mustache','views/pagination','views/ubbcode'],wrap);}
else{exports.Ccomment||(exports.Ccomment={});exports.Ccomment.CommentsOuter=wrap(Epitome.View,exports.Ccomment.Comment,exports.Ccomment.User,Mustache,exports.Ccomment.Pagination,exports.Ccomment.UbbCode);}}(this));